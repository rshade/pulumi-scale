# Data Model: IaC Autoscaler (PulumiScale)

## Core Entities

### 1. ScalingRule (Configuration)
**Source**: Defined by the user in Pulumi Stack Outputs.
**Purpose**: Tells the autoscaler *what* to watch and *how* to scale it.

```go
type ScalingStrategy string

const (
    StrategyIncremental ScalingStrategy = "incremental" // +/- delta
    StrategyAbsolute    ScalingStrategy = "absolute"    // set to value
)

type ScalingRule struct {
    // The key in the user's stack output map (e.g., "worker-pool")
    PoolName string `json:"-"` 

    // The Pulumi URN of the resource to target with `pulumi up -t`
    // Example: "urn:pulumi:dev::my-stack::aws:autoscaling/group:Group::workers"
    TargetURN string `json:"targetUrn"`

    // The Pulumi Config key to update
    // Example: "workerCount"
    ConfigKey string `json:"configKey"`

    // Scaling limits (Guardrails)
    Min int `json:"min"`
    Max int `json:"max"`

    // Cooldown in seconds before allowing another scale event
    CooldownSeconds int `json:"cooldown"`

    // (Optional) Strategy defaults. Webhooks can override or imply this.
    Strategy ScalingStrategy `json:"strategy"`
}
```

### 2. ScalingIntent (Internal Event)
**Source**: Generated by Webhook Adapters after parsing vendor-specific payloads.
**Purpose**: Normalized instruction to scale a specific pool.

```go
type IntentAction string

const (
    ActionSet   IntentAction = "set"
    ActionDelta IntentAction = "delta"
)

type ScalingIntent struct {
    // The pool to target (must match a ScalingRule.PoolName)
    TargetPool string

    // What to do
    Action IntentAction

    // The value (e.g., 50 for Set, +1/-1 for Delta)
    Value int
    
    // Metadata for logging
    Source string // "cloudwatch", "prometheus", "manual"
    Reason string // "CPU > 80%", "Alarm Triggered"
}
```

### 3. ScalingResult (Outcome)
**Source**: Generated by the Engine after attempting an update.

```go
type ScalingResult struct {
    Pool          string
    OldValue      int
    NewValue      int
    DryRun        bool
    Success       bool
    Error         string
    DurationMs    int64
}
```
